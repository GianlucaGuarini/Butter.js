!function(t,e){"function"==typeof define&&define.amd?define(["baconjs","jquery"],e):"object"==typeof exports?module.exports=e(require("baconjs"),require("jquery")):t.Butter=e(Bacon,jQuery)}(this,function(t,e){var n,i,s,r,u,h,o,a;return n=a=function(t){var n=Object.prototype.toString,i=Array.prototype.indexOf,s=Array.prototype.forEach;return t={$:e,isBoolean:function(t){return"boolean"==typeof t},isObject:function(t){return"[object Object]"===n.call(t)},isString:function(t){return"string"==typeof t},isArray:function(t){return"[object Array]"===n.call(t)},isFunction:function(t){return"function"==typeof t},isUndefined:function(t){return"undefined"==typeof t},extend:function(t,e){for(var n in e)t[n]=e[n];return this.clone(t)},clone:function(t){return t?JSON.parse(JSON.stringify(t)):{}},indexOf:function(t,n){return i?i.call(n,t):e.inArray(t,n)},each:function(t,n,i){var r=this;return s?s.call(t,i?this.bind(n,i):n):e.each(t,function(t,e){i?r.bind(n,i,e,t):n(e,t)})},bind:function(t,e){return function(){return t.apply(e,arguments)}},isEqual:function(t,e){return JSON.stringify(t)===JSON.stringify(e)},getObjectValueByPath:function(t,e){var n,i,s,r=0,u=t;for(n=e&&e.split("."),i=n&&n.length;i>r&&u;)s=n[r],u=u[s],r++;return i>r&&(u=null),u},setObjectValueByPath:function(t,e,n){e=e.split(".");for(var i=0;i<e.length-1;i++){if(!t[e[i]])return!1;t=t[e[i]]}return null!==n&&void 0!==n?(t[e[i]]=n,!0):(t[e[i]]=null,delete t[e[i]],!0)}}}({}),i=function(t){return t={view:{binderSelector:"data-",destroyModelsCreated:!0},data:{maxStatesLength:10}}}({}),s=function(t){var e=n;return t={extend:function(t){return e.extend(this,t)},exec:function(t){"function"==typeof this[t]&&this[t].apply(this,arguments)},removeProperties:function(){e.each(this,function(t,e){this[e]=null,delete this[e]},this)}}}({}),r=function(t){return t={text:function(t,e,n){return{set:function(){e.listen(n).onValue(t,"text")}}},val:function(t){return{events:function(){t.asEventStream("change")},get:function(){return t.val()},set:function(e){t.val(e)}}}}}({}),u=function(e){var r=n,u=i,h=s;return e=function(e){var n=0,i=null;return this._constructor=function(){return r.extend(this,h),r.extend(this,u.data),this.state=[],this.changes=new t.Bus,this.events=new t.Bus,(r.isObject(e)||r.isArray(e))&&(this.set(e),i=this.get()),this},this._changeToState=function(t,e){this.state[t]&&(n=t,this.update(this.state[t].attributes,e))},this.toString=function(){return JSON.stringify(this.get())},this.get=function(t){var e=this.state[n];return e?r.isString(t)?r.getObjectValueByPath(e.attributes,t):r.clone(e.attributes):{}},this.set=function(){var t=this.get(),e=!1;return r.isString(arguments[0])?e=r.setObjectValueByPath(t,arguments[0],arguments[1]):(r.extend(t,arguments[0]),e=!0),e&&this.update(t,"set"),this},this.unset=function(t){var e=this.get();return t&&r.setObjectValueByPath(e,t,null)&&this.update(e,"unset"),this},this.reset=function(){return this.update(i,"reset"),this},this.update=function(t,e){this.changes.push(t),this.events.push(e),~r.indexOf(e,["set","unset","reset"])&&(this.state.push({method:e,attributes:t}),this.state.length>this.maxStatesLength+1&&this.state.shift(),n=this.state.length-1)},this.bind=function(t,e,n,i){var s=r.isUndefined(i)?!0:i,u=function(e){n?t.set(n,e):t.set(e)};e?this.listen(e).onValue(u):this.changes.skipDuplicates(r.isEqual).onValue(u),s&&t.bind(this,n,e,!1)},this.listen=function(t){return this.changes.map("."+t).skipDuplicates(r.isEqual)},this.undo=function(){n>0&&this._changeToState(--n,"undo")},this.redo=function(){n<this.maxStatesLength&&this._changeToState(++n,"redo")},this.destroy=function(){this.changes.end(),this.events.end(),this.removeProperties()},this._constructor()}}({}),h=function(e){var r=n,u=i,h=s;return e=function(e){return this._constructor=function(){return r.extend(this,h),r.extend(this,u.view),this.bindings=[],this.views=[],this.template=e.template,this.destroyDataOnRemove=!1,this.state=new t.Bus,r.each(e,function(t,e){"function"==typeof e?this[t]=e:"data"===t&&(e instanceof o.Data?this[t]=e:(this[t]=new o.Data(e),this.destroyDatasCreated&&(this.destroyDataOnRemove=!0)))},this),e.el&&this.setElement(e.el),this.state.onValue(r.bind(this.exec,this)),this},this.setElement=function(t){return this.$el=t instanceof r.$?e.el:r.$(t),this.el=this.$el[0],this.el||console.warn(e.el+"was not found!"),this},this.$=function(t){return r.$(t,this.$el)},this.render=function(){return this.state.push("beforeRender"),this.template&&this.$el.html(this.template),this.bind().state.push("afterRender"),this},this.unbind=function(){return this.$el.off(),r.each(e.events,function(t,e){this[e.name]&&(this[e.name].onValue()(),this[e.name]=null)},this),this},this.bind=function(){return this.unbind(),r.each(e.events,function(t){this[t.name]=this.$el.asEventStream(t.type,t.el)},this),this},this.parse=function(){},this.remove=function(){this.state.push("beforeRemove"),this.state.end(),this.destroyDataOnRemove&&this.model.destroy(),this.$el.remove(),this.removeProperties()},this._constructor()}}({}),o=function(t){return t={helpers:n,defaults:i,mixins:s,binders:r,Data:u,View:h}}({})});