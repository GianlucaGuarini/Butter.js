(function(e,t){typeof define=="function"&&define.amd?define(["baconjs","jquery"],function(n,r){return e.Butter=t(n,r)}):typeof exports=="object"?module.exports=t(require("baconjs"),require("jquery")):e.Butter=t(Bacon,jQuery)})(this,function(e,t){var n,r,i,s,o,u,a,f,l,c;return n=c=function(n){var r=Object.prototype.toString,i=Object.keys,s=Array.prototype.indexOf,o=Array.prototype.forEach,u=function(e,t){var n,r=0,i;t=t.replace(/\[(\w+)\]/g,".$1").replace(/^\./,"").split("."),n=t&&t.length;while(r<n-1){i=t[r];if(!e[i])return;e=e[i],r++}return{pathArray:t,lastKey:t[t.length-1],value:e}},a={$:t,isBoolean:function(e){return typeof e=="boolean"},isObject:function(e){return r.call(e)==="[object Object]"&&!a.isUndefined(e)},isString:function(e){return typeof e=="string"},isArray:function(e){return r.call(e)==="[object Array]"},isRegExp:function(e){return r.call(e)==="[object RegExp]"},isFunction:function(e){return typeof e=="function"},isUndefined:function(e){return typeof e=="undefined"},isEqual:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},isEmpty:function(e){return a.isObject?JSON.stringify(e).length===2:e.length===0},extend:function(e,t){for(var n in t)e[n]=t[n];return e},difference:function(e,t,n){var r=this,i=!1;return a.isEqual(e,t)||(i=e,a.isArray(e)?(i=[],a.each(e,function(e){r.contains(t,e)||i.push(e)})):a.isObject(e)&&(i={},a.each(e,function(e,n){t[e]||(i[e]=n)}))),i},clone:function(e){return a.isArray(e)||a.isObject(e)?JSON.parse(JSON.stringify(e)):e},contains:function(e,t){return!!~a.indexOf(e,t)},indexOf:function(t,n){var r=-1,i=0,o=t.length;if(a.isObject(n)){for(;i<o;i++)if(a.isEqual(t[i],n)){r=i;break}return r}return s?s.call(t,n):e._.indexOf(t,n)},each:function(e,n,r){var s=this,u=a.isObject(e);r=r||n.prototype;if(!e)return;o&&i?u?o.call(i(e),function(t){n.apply(r,[t,e[t]])}):o.call(e,a.bind(n,r)):t.each(e,function(e,t){n.apply(r,u?[e,t]:[t,e])})},keys:i||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},bind:function(e,t){return function(){return e.apply(t,arguments)}},getObjectValueByPath:function(e,t){var n=u(e,t);if(!n||!n.value)return;return n.value[n.lastKey]},setObjectValueByPath:function(e,t,n){var r=u(e,t);if(!r||!r.value)return;return n!==null&&n!==undefined?(r.value[r.lastKey]=n,r.value):(r.value[r.lastKey]=null,delete r.value[r.lastKey],!0)}};return n=a,n}({}),r=function(e){return e={view:{binderSelector:"data-",destroyDatasCreated:!0,tagName:"div",id:null,className:null,fetchTemplate:function(e){return t(e).html()},insert:function(e){this.$el.append(e)}},data:{maxStatesLength:10,emulateHTTP:!0},router:{}},e}({}),i=function(e){var t=n;return e={extend:function(e){return t.extend(this,e),this},exec:function(e){typeof this[e]=="function"&&this[e].apply(this,arguments)},removeProperties:function(){t.each(this,function(e,t){this[t]=null,delete this[t]},this)}},e}({}),s=function(e){var t=n,r=function(e){t.each(e,function(e){e()})};return e={each:function(e,n,r){e.removeAttr(u.defaults.view.binderSelector+"each");var i=r.split(/\s+as\s+/gi),s=[],o=i[0],a=i[1],f=e.parent(),l=e.clone().removeAttr(u.defaults.view.binderSelector+"each");return e.remove(),{deferred:!0,addSubview:function(e,t){var r=l.clone(),i;return i=new u.View({el:r,data:n,placeholderPath:a,bindingPath:o+"."+t}),s.push(i),i.bind(),i},get:function(){},set:function(){var e=[];t.each(n.get(o),function(){e.push(this.addSubview.apply(this,arguments).$el)},this),f.append(e),e=null,n.listen(o).debounce(50).onValue(t.bind(function(t){var n=s.length-t.length;if(!n)return;if(n>0)while(n--)s[s.length-1].remove(),s.splice(s.length-1,1);else{e=[];while(n++<0){var r=t.length+n-1;e.push(this.addSubview(t[r],r).$el)}f.append(e)}},this))},bind:function(){this.set(),this.get()},unbind:function(){t.each(s,function(e){e.remove()}),s=null,e.attr(u.defaults.view.binderSelector+"each",r),f.append(e)}}},show:function(e,t,n,r){var i;return{deferred:!0,get:function(){var s=function(t){t?e[r?"hide":"show"]():e[r?"show":"hide"]()};i=t.listen(n).debounce(50).onValue(s),s(t.get(n))},bind:function(){this.get()},unbind:function(){i()}}},hide:function(e,t,n){return this.show(e,t,n,!0)},css:function(e,n,i){var s=i.split(/\s+(?:&&|and)\s+/gi),o=[];return{set:function(){t.each(s,function(t){var r=t.split(/\s+as\s+/gi);o.push(n.listen(r[0]).startWith(n.get(r[0])).assign(e,"css",r[1]))})},bind:function(){this.set()},unbind:function(){r(o)}}},text:function(e,t,n){var r;return{set:function(){r=t.listen(n).debounce(50).startWith(t.get(n)).onValue(e,"text")},bind:function(){this.set()},unbind:function(){r()}}},value:function(e,t,n){var i=[],s=e.asEventStream("input change copy paste");return{get:function(){i.push(s.map(function(){return e.val()}).debounce(50).assign(t,"set",n))},set:function(){i.push(t.listen(n).startWith(t.get(n)).assign(e,"val"))},bind:function(){this.set(),this.get()},unbind:function(){r(i)}}}},e}({}),!function(e){"object"==typeof c&&"undefined"!=typeof module?module.exports=e():o=function(){return typeof e=="function"?e():e}()}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=t[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){function f(e,t){if("function"==typeof e)return f("*",e);if("function"==typeof t){var n=new h(e);for(var r=1;r<arguments.length;++r)f.callbacks.push(n.middleware(arguments[r]))}else"string"==typeof e?"string"==typeof t?f.redirect(e,t):f.show(e,t):f.start(e)}function l(e){if(e.handled)return;var t=i.pathname+i.search;if(t===e.canonicalPath)return;f.stop(),e.handled=!1,i.href=e.canonicalPath}function c(e,t){"/"===e[0]&&0!==e.indexOf(o)&&(e=o+e);var n=e.indexOf("?");this.canonicalPath=e,this.path=e.replace(o,"")||"/",this.title=document.title,this.state=t||{},this.state.path=e,this.querystring=~n?e.slice(n+1):"",this.pathname=~n?e.slice(0,n):e,this.params=[],this.hash="";if(!~this.path.indexOf("#"))return;var r=this.path.split("#");this.path=r[0],this.hash=r[1]||"",this.querystring=this.querystring.split("#")[0]}function h(e,t){t=t||{},this.path=e==="*"?"(.*)":e,this.method="GET",this.regexp=r(this.path,this.keys=[],t.sensitive,t.strict)}function p(e){if(e.state){var t=e.state.path;f.replace(t,e.state)}}function d(e){if(1!=v(e))return;if(e.metaKey||e.ctrlKey||e.shiftKey)return;if(e.defaultPrevented)return;var t=e.target;while(t&&"A"!=t.nodeName)t=t.parentNode;if(!t||"A"!=t.nodeName)return;var n=t.getAttribute("href");if(!(t.pathname!==i.pathname||!t.hash&&"#"!==n))return;if(n&&n.indexOf("mailto:")>-1)return;if(t.target)return;if(!m(t.href))return;var r=t.pathname+t.search+(t.hash||""),s=r+t.hash;r=r.replace(o,"");if(o&&s===r)return;e.preventDefault(),f.show(r)}function v(e){return e=e||window.event,null===e.which?e.button:e.which}function m(e){var t=i.protocol+"//"+i.hostname;return i.port&&(t+=":"+i.port),e&&0===e.indexOf(t)}var r=e("path-to-regexp");t.exports=f;var i=window.history.location||window.location,s=!0,o="",u,a=!1;return f.callbacks=[],f.base=function(e){if(0===arguments.length)return o;o=e},f.start=function(e){e=e||{};if(u)return;u=!0,!1===e.dispatch&&(s=!1),!1!==e.popstate&&window.addEventListener("popstate",p,!1),!1!==e.click&&window.addEventListener("click",d,!1),!0===e.hashbang&&(a=!0);if(!s)return;var t=a&&i.hash.indexOf("#!")===0?i.hash.substr(2)+i.search:i.pathname+i.search+i.hash;f.replace(t,null,!0,s)},f.stop=function(){u=!1,removeEventListener("click",d,!1),removeEventListener("popstate",p,!1)},f.show=function(e,t,n){var r=new c(e,t);return!1!==r.handled&&r.pushState(),!1!==n&&f.dispatch(r),r},f.redirect=function(e,t){f(e,function(e){setTimeout(function(){f.replace(t)})})},f.replace=function(e,t,n,r){var i=new c(e,t);return i.init=n,i.save(),!1!==r&&f.dispatch(i),i},f.dispatch=function(e){function n(){var r=f.callbacks[t++];if(!r)return l(e);r(e,n)}var t=0;n()},f.Context=c,c.prototype.pushState=function(){history.pushState(this.state,this.title,a&&this.canonicalPath!=="/"?"#!"+this.canonicalPath:this.canonicalPath)},c.prototype.save=function(){history.replaceState(this.state,this.title,a&&this.canonicalPath!=="/"?"#!"+this.canonicalPath:this.canonicalPath)},f.Route=h,h.prototype.middleware=function(e){var t=this;return function(n,r){if(t.match(n.path,n.params))return e(n,r);r()}},h.prototype.match=function(e,t){var n=this.keys,r=e.indexOf("?"),i=~r?e.slice(0,r):e,s=this.regexp.exec(decodeURIComponent(i));if(!s)return!1;for(var o=1,u=s.length;o<u;++o){var a=n[o-1],f="string"==typeof s[o]?decodeURIComponent(s[o]):s[o];a?t[a.name]=undefined!==t[a.name]?t[a.name]:f:t.push(f)}return!0},f.sameOrigin=m,n},{"path-to-regexp":2}],2:[function(e,t,n){function i(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function o(e,t,n){t&&!Array.isArray(t)&&(n=t,t=null),t=t||[],n=n||{};var u=n.strict,a=n.end!==!1,f=n.sensitive?"":"i",l=0;if(e instanceof RegExp){var c=e.source.match(/\((?!\?)/g)||[];return t.push.apply(t,c.map(function(e,t){return{name:t,delimiter:null,optional:!1,repeat:!1}})),s(e,t)}if(Array.isArray(e))return e=e.map(function(e){return o(e,t,n).source}),s(new RegExp("(?:"+e.join("|")+")",f),t);e=e.replace(r,function(e,n,r,s,o,u,a,f){if(n)return n;if(f)return"\\"+f;var c=a==="+"||a==="*",h=a==="?"||a==="*";return t.push({name:s||l++,delimiter:r||"/",optional:h,repeat:c}),r=r?"\\"+r:"",o=i(o||u||"[^"+(r||"\\/")+"]+?"),c&&(o=o+"(?:"+r+o+")*"),h?"(?:"+r+"("+o+"))?":r+"("+o+")"});var h=e[e.length-1]==="/";return u||(e=(h?e.slice(0,-2):e)+"(?:\\/(?=$))?"),a||(e+=u&&h?"":"(?=\\/|$)"),s(new RegExp("^"+e+(a?"$":""),f),t)}t.exports=o;var r=new RegExp(["(\\\\.)","([\\/.])?(?:\\:(\\w+)(?:\\(((?:\\\\.|[^)])*)\\))?|\\(((?:\\\\.|[^)])*)\\))([+*?])?","([.+*?=^!:${}()[\\]|\\/])"].join("|"),"g"),s=function(e,t){return e.keys=t,e};return n},{}]},{},[1])(1)}),a=function(s){var o=n,a=r,f=i,l=function(t){return this.__initialValues=t,this.__currentStateIndex=0,o.extend(this,f),o.extend(this,a.data),this.state=[],this.changes=new e.Bus,this.events=new e.Bus,this.isNew=!0,o.isUndefined(t)||this.set(t),this};return l.prototype={constructor:l,_changeToState:function(e,t){return this.state[e]&&(this.__currentStateIndex=e,this.update(this.state[e].attributes,t)),this},toString:function(){return JSON.stringify(this.toJSON())},toJSON:function(){return this.get()},get:function(e){var t=this.state[this.__currentStateIndex],n;return o.isUndefined(t)?n=undefined:o.isString(e)?n=o.getObjectValueByPath(t.attributes,e):o.isObject(t.attributes)||o.isArray(t.attributes)?n=t.attributes:n=t.attributes,o.clone(n)},parse:function(e){return e},validate:function(e){return!0},changedAttributes:function(){return this.maxStatesLength>2&&this.__currentStateIndex?o.difference(this.state[this.__currentStateIndex-1].attributes,this.get()):this.get()},sync:function(n,r){var i,s,u;r=r||{};if(!this.url)throw new Error("This class instance doesn't have any url, it cannot be synched");switch(n){case"save":this.isNew?(n="create",i="POST"):(n="update",r.patch?i="PATCH":i="PUT");break;case"delete":i="DELETE";break;default:n="read",i="GET"}return i==="PATCH"?u=this.changedAttributes():i!=="GET"&&(u=this.get()),this.emulateHTTP&&u&&(u=o.extend({_method:i},u)),s=t.ajax(o.extend({url:this.url,type:this.emulateHTTP?i==="GET"?"GET":"POST":i,data:i==="GET"?null:JSON.stringify(u),dataType:"json"},r)),s.always(o.bind(function(){this.events.push("sync")},this)),s.success(o.bind(function(e){i==="GET"?this.update(e,"read"):this.events.push(n)},this)),s.fail(o.bind(this.events.error,this.events)),new e.fromPromise(s)},fetch:function(e){return this.sync("read",e)},save:function(e){return this.sync("save",e)},set:function(){var e=arguments,t=this.toJSON(),n=!1;return e.length===2&&o.isString(e[0])&&e[1]?n=o.setObjectValueByPath(t,e[0],e[1]):(o.isObject(t)?o.extend(t,e[0]):t=e[0],n=!0),n&&this.update(t,"set"),this},unset:function(e){var t=this.get();return e?o.setObjectValueByPath(t,e,null):t=undefined,this.update(t,"unset"),this},reset:function(){return this.update(this.__initialValues,"reset"),this},add:function(e,t,n){var r=o.isString(t)?this.get(t):this.get();if(!o.isArray(r))throw new Error("You cannot push new data in an element that is not an array");return r.splice(n||r.length,0,e),t?this.set(t,r):this.update(r,"add"),this},remove:function(e,t){var n=o.isString(t)?this.get(t):this.get(),r;if(!o.isArray(n))throw new Error("You cannot remove data from an element that is not an array");r=o.indexOf(n,e);if(!~r)throw new Error(JSON.stringify(e)+" was not found in this array");return n.splice(r,1),t?this.set(t,n):this.update(n,"remove"),this},update:function(e,t){var n=this.validate(e);return n!==!0?(this.events.error(n),!1):(e=this.parse(e),o.contains(["set","unset","reset","read","add","remove"],t)&&(this.state.push({method:t,attributes:e}),this.state.length>this.maxStatesLength+1&&this.state.shift(),this.__currentStateIndex=this.state.length-1,o.isArray(e)&&(this.length=e.length)),this.changes.push(e),this.events.push(t),this.attributes=e,this)},clone:function(){return(new u.Data(this.get())).extend(this)},bind:function(e,t,n,r){var i=this,s=o.isUndefined(r)?!0:r;return s&&e.listen(n).onValue(function(e){i.set.apply(i,t?[t,e]:[e])}),this.listen(t).onValue(function(t){e.set.apply(e,n?[n,t]:[t])}),this},listen:function(e){var t,n;return e?(t=this.get(e),n=this.changes.map("."+e)):(t=this.get(),n=this.changes),n.startWith(t).skipWhile(function(e){return o.isEqual(e,t)}).skipDuplicates(o.isEqual)},on:function(e){return this.events.filter(function(t){return o.contains(e.split(" "),t)}).skipDuplicates()},undo:function(){return this.__currentStateIndex>0&&this._changeToState(--this.__currentStateIndex,"undo"),this},redo:function(){return this.__currentStateIndex<this.maxStatesLength&&this._changeToState(++this.__currentStateIndex,"redo"),this},destroy:function(e){var t,n=o.bind(function(){this.changes.end(),this.events.end(),this.removeProperties()},this);this.url&&!this.isNew?this.sync("delete",e).done(n):n()}},s=l,s}({}),f=function(o){var a=n,f=s,l=r,c=i,h=function(t){return this.options=t,this.destroyDataOnRemove=!1,this.events=[],this.callbacks=[],this.binders=[],this.subviews=[],a.extend(this,c),a.extend(this,l.view),a.extend(this,t||{}),this.state=new e.Bus,this.setData(this.data),this.setElement(this.el),this.state.onValue(a.bind(this.exec,this)),this};return h.prototype={constructor:h,setData:function(e){return this.options?(e&&e instanceof u.Data?this.data=e:(this.data=new u.Data(this.data),this.destroyDatasCreated&&(this.destroyDataOnRemove=!0)),this):this},setElement:function(e){var n={};return e?this.$el=e instanceof a.$?this.options.el:a.$(e):this.$el=t("<"+this.tagName+">"),this.el=this.$el[0],this.className&&(n["class"]=this.className),this.id&&(n.id=this.id),this.$el.attr(n),this},$:function(e){return a.$(e,this.$el)},render:function(){return this.state.push("beforeRender"),this.template&&(a.isString(this.template)&&(this.template=this.fetchTemplate(this.template)),this.$el.html(a.isFunction(this.template)?this.template(this.data.get()):this.template)),this.bind(),a.isArray(this.views)&&this.insertSubviews(this.views),this.state.push("afterRender"),this},insertSubviews:function(e){return a.each(e,function(e){var t=a.keys(e)[0],n=e[t];t?this.setSubview(t,n):this.insertSubview(n),n.render()},this),this},insertSubview:function(e){return this.subviews.push(e),this.insert(e.$el),e},setSubview:function(e,t){var n=this.$(e);if(!n.length)throw new Error("no element found with the "+e+" selector");return this.subviews.push(t),n.append(t.$el),t},unbind:function(){return this.$el.off(),a.each(this.events,function(e,t){this[t.name]&&(this[t.name].onValue()(),this[t.name]=null)},this),a.each(this.callbacks,function(e){e()}),a.each(this.subviews,function(e){e.unbind()}),a.each(this.binders,function(e){e()},this),this.binders=[],this},on:function(e){return this.state.filter(function(t){return a.contains(e.split(" "),t)}).skipDuplicates()},bindingPath:"",placeholderPath:"",bind:function(){var e=this,n=[];return this.unbind(),a.each(this.subviews,function(e){e.bind()}),a.each(this.events,function(e,t){if(!e.name)throw new Error("You must specify an event name for each event assigned to this view");this[e.name]=this.$el.asEventStream(e.type,e.el),this.methods[e.name]&&a.isFunction(this.methods[e.name])&&this.callbacks.push(this[e.name].onValue(a.bind(this.methods[e.name],this)))},this),a.each(f,function(r){var i=this.binderSelector+r,s=function(s){var o=t(this),u=s||o.attr(i),a;e.placeholderPath&&e.bindingPath&&(u=u.replace(e.placeholderPath,e.bindingPath));if(!u)throw new Error("The path to the data values is missing on the element "+this);u=u.replace(/[\n\r]+/g,"").replace(/^\s\s*/,"").replace(/\s\s*$/,""),a=f[r](o,e.data,u),a.deferred?n.push(a):a.bind(),e.binders.push(a.unbind)};this.$("["+i+"]").each(s);var o=this.$el.attr(i);o&&s.call(this.el,o)},this),a.each(n,function(e){e.bind()}),this},remove:function(){this.state.push("beforeRemove"),this.state.end(),this.unbind(),this.destroyDataOnRemove&&this.data.destroy(),a.each(this.subviews,function(e){e.remove()},this),this.$el&&this.$el.remove(),this.removeProperties()}},o=h,o}({}),l=function(t){var u=n,a=s,f=r,l=i,c=o,h=function(){return u.extend(this,l),this};return h.prototype={constructor:h,map:function(t){var n=new e.Bus;return c(t,function(e){n.push(e)}),n}},t=h,t}({}),u=function(e){return e={helpers:n,defaults:r,mixins:i,binders:s,history:o,Data:a,View:f,Router:l,create:{View:function(e){return new u.View(e)},Data:function(e){return new u.Data(e)}}},e}({}),u});