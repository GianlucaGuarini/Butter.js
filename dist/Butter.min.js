!function(t,e){"function"==typeof define&&define.amd?define(["baconjs","jquery"],e):"object"==typeof exports?(Bacon=require("baconjs"),$=require("jquery"),module.exports=e()):t.Butter=e(Bacon,jQuery)}(this,function(t,e){var n,i,s,r,u,h,o;return n=function(t){return t={$:e,extend:e.extend,indexOf:e.inArray,each:function(t,n,i){return e.each(t,i?this.bind(n,i):n)},bind:e.proxy,isObject:function(t){return"object"===e.type(t)},isString:function(t){return"string"===e.type(t)},isFunction:function(t){return"function"===e.type(t)},isEqual:function(t,e){return JSON.stringify(t)===JSON.stringify(e)},getObjectValueByPath:function(t,e){var n,i,s,r=0,u=t;for(n=e&&e.split("."),i=n&&n.length;i>r&&u;)s=n[r],u=u[s],r++;return i>r&&(u=null),u},setObjectValueByPath:function(t,e,n){e=e.split(".");for(var i=0;i<e.length-1;i++){if(!t[e[i]])return!1;t=t[e[i]]}return null!==n&&void 0!==n?(t[e[i]]=n,!0):(t[e[i]]=null,delete t[e[i]],!0)}}}({}),i=function(t){return t={view:{binderSelector:"data-",destroyModelsCreated:!0},model:{stateMaxLength:12}}}({}),s=function(t){var e=n;return t={extend:function(t){return e.extend(!0,this,t)},exec:function(t){"function"==typeof this[t]&&this[t].apply(this,arguments)},removeProperties:function(){e.each(this,function(t,e){this[e]=null,delete this[e]},this)}}}({}),r=function(t){return t={text:function(t,e,n){return{set:function(){e.listen(n).onValue(t,"text")}}},val:function(t){return{events:function(){t.asEventStream("change")},get:function(){return t.val()},set:function(e){t.val(e)}}}}}({}),u=function(e){var r=n,u=i,h=s;return e=function(e){var n=0;return this._constructor=function(){return r.extend(!0,this,h),this.state=[],this.defaults=u.model,this.changes=new t.Bus,this.events=new t.Bus,r.isObject(e)&&this.set(e),this},this.toString=function(){return JSON.stringify(this.get())},this.get=function(t){var e=this.state[n];return e?r.isString(t)?r.getObjectValueByPath(e.attributes,t):r.extend(!0,{},e.attributes):{}},this.set=function(){var t=this.get(),e=!1;return r.isString(arguments[0])?e=r.setObjectValueByPath(t,arguments[0],arguments[1]):(r.each(arguments[0],function(e,n){t[e]=n}),e=!0),e&&this.update(t,"set"),this},this.unset=function(t){var e=this.get();return t&&r.setObjectValueByPath(e,t,null)&&this.update(e,"unset"),this},this.reset=function(){return this.update({},"reset"),this},this.update=function(t,e){this.changes.push(t),this.events.push(e),~r.indexOf(e,["set","unset","reset"])&&(this.state.push({method:e,attributes:t}),this.state.length>this.defaults.stateMaxLength+1&&this.state.shift(),n=this.state.length-1)},this.listen=function(t){return this.changes.map("."+t).skipDuplicates(r.isEqual)},this.changeToState=function(t,e){this.state[t]&&(n=t,this.update(this.state[t].attributes,e))},this.undo=function(){n>0&&this.changeToState(--n,"undo")},this.redo=function(){n<this.defaults.stateMaxLength&&this.changeToState(++n,"redo")},this.destroy=function(){this.changes.end(),this.events.end(),this.removeProperties()},this._constructor()}}({}),h=function(e){var r=n,u=i,h=s;return e=function(e){return this._constructor=function(){return r.extend(!0,this,h),this.bindings=[],this.views=[],this.template=e.template,this.destroyModelOnRemove=!1,this.state=new t.Bus,this.defaults=u.view,r.each(e,function(t,e){"function"==typeof e?this[t]=e:"model"===t&&(e instanceof o.Model?this[t]=e:(this[t]=new o.Model(e),this.destroyModelsCreated&&(this.destroyModelOnRemove=!0)))},this),e.el&&this.setElement(e.el),this.state.onValue(r.bind(this.exec,this)),this},this.setElement=function(t){return this.$el=t instanceof r.$?e.el:r.$(t),this.el=this.$el[0],this.el||console.warn(e.el+"was not found!"),this},this.$=function(t){return r.$(t,this.$el)},this.render=function(){return this.state.push("beforeRender"),this.template&&this.$el.html(this.template),this.bind().state.push("afterRender"),this},this.unbind=function(){return this.$el.off(),r.each(e.events,function(t,e){this[e.name]&&(this[e.name].onValue()(),this[e.name]=null)},this),this},this.bind=function(){return this.unbind(),r.each(e.events,function(t,e){this[e.name]=this.$el.asEventStream(e.type,e.el)},this),this},this.parse=function(){},this.remove=function(){this.state.push("beforeRemove"),this.state.end(),this.destroyModelOnRemove&&this.model.destroy(),this.$el.remove(),this.removeProperties()},this._constructor()}}({}),o=function(t){return t={helpers:n,defaults:i,mixins:s,binders:r,Model:u,View:h}}({})});