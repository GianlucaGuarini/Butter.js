/**
 *
 * Version: 0.0.1-alpha
 * Author: Gianluca Guarini
 * Contact: gianluca.guarini@gmail.com
 * Website: http://www.gianlucaguarini.com/
 * Twitter: @gianlucaguarini
 *
 * Copyright (c) Gianluca Guarini
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
      _       _
     (_\     /_)
       ))   ((
     .-"""""""-.
 /^\/  _.   _.  \/^\
 \(   /__\ /__\   )/
  \,  \o_/_\o_/  ,/
    \    (_)    /
     `-.'==='.-'
      __) - (__
     /  `~~~`  \
    /  /     \  \
    \ :       ; /
     \|==(*)==|/
      :       :
       \  |  /
     ___)=|=(___
    {____/ \____}

 */!function(a,b){"function"==typeof define&&define.amd?define(["baconjs","jquery"],b):"object"==typeof exports?(Bacon=require("baconjs"),$=require("jquery"),module.exports=b()):a.Butter=b(Bacon,jQuery)}(this,function(a,b){"use strict";var c={};return c.defaults={view:{binderSelector:"data-",destroyModelsCreated:!0},model:{stateMaxLength:12}},c.binders={text:function(a,b,c){return{set:function(){b.listen(c).onValue(a,"text")}}},val:function(a){return{events:function(){a.asEventStream("change")},get:function(){return a.val()},set:function(b){a.val(b)}}}},c.mixins={extend:function(a){return c.helpers.extend(!0,this,a)},exec:function(a){"function"==typeof this[a]&&this[a].apply(this,arguments)},removeProperties:function(){c.helpers.each(this,function(a,b){this[b]=null,delete this[b]},this)}},c.helpers={$:b,extend:b.extend,indexOf:b.inArray,each:function(a,d,e){return b.each(a,e?c.helpers.bind(d,e):d)},bind:b.proxy,isObject:function(a){return"object"===b.type(a)},isString:function(a){return"string"===b.type(a)},isFunction:function(a){return"function"===b.type(a)},getObjectValueByPath:function(a,b){var c,d,e,f=0,g=a;for(c=b&&b.split("."),d=c&&c.length;d>f&&g;)e=c[f],g=g[e],f++;return d>f&&(g=null),g},setObjectValueByPath:function(a,b,c){b=b.split(".");for(var d=0;d<b.length-1;d++){if(!a[b[d]])return!1;a=a[b[d]]}return null!==c&&void 0!==c?(a[b[d]]=c,!0):(a[b[d]]=null,delete a[b[d]],!0)}},c.Model=function(b){var d=0;return this._constructor=function(){return c.helpers.extend(!0,this,c.mixins),this.state=[],this.defaults=c.defaults.model,this.changes=new a.Bus,this.events=new a.Bus,c.helpers.isObject(b)&&this.set(b),this},this.toString=function(){return JSON.stringify(this.get())},this.get=function(a){var b=this.state[d];return b?c.helpers.isString(a)?c.helpers.getObjectValueByPath(b.attributes,a):c.helpers.extend(!0,{},b.attributes):{}},this.set=function(){var a=this.get(),b=!1;return c.helpers.isString(arguments[0])?b=c.helpers.setObjectValueByPath(a,arguments[0],arguments[1]):(c.helpers.each(arguments[0],function(b,c){a[b]=c}),b=!0),b&&this.update(a,"set"),this},this.unset=function(a){var b=this.get();return a&&c.helpers.setObjectValueByPath(b,a,null)&&this.update(b,"unset"),this},this.reset=function(){return this.update({},"reset"),this},this.update=function(a,b){this.changes.push(a),this.events.push(b),~c.helpers.indexOf(b,["set","unset","reset"])&&(this.state.push({method:b,attributes:a}),this.state.length>this.defaults.stateMaxLength+1&&this.state.shift(),d=this.state.length-1)},this.listen=function(a){return this.changes.map("."+a).skipDuplicates()},this.changeToState=function(a,b){this.state[a]&&(d=a,this.update(this.state[a].attributes,b))},this.undo=function(){d>0&&this.changeToState(--d,"undo")},this.redo=function(){d<this.defaults.stateMaxLength&&this.changeToState(++d,"redo")},this.destroy=function(){this.changes.end(),this.events.end(),this.removeProperties()},this._constructor()},c.View=function(b){return this._constructor=function(){return c.helpers.extend(!0,this,c.mixins),this.bindings=[],this.views=[],this.template=b.template,this.destroyModelOnRemove=!1,this.state=new a.Bus,this.defaults=c.defaults.view,c.helpers.each(b,function(a,b){"function"==typeof b?this[a]=b:"model"===a&&(b instanceof c.Model?this[a]=b:(this[a]=new c.Model(b),this.destroyModelsCreated&&(this.destroyModelOnRemove=!0)))},this),b.el&&this.setElement(b.el),this.state.onValue(c.helpers.bind(this.exec,this)),this},this.setElement=function(a){return this.$el=a instanceof c.helpers.$?b.el:c.helpers.$(a),this.el=this.$el[0],this.el||console.warn(b.el+"was not found!"),this},this.$=function(a){return c.helpers.$(a,this.$el)},this.render=function(){return this.state.push("beforeRender"),this.template&&this.$el.html(this.template),this.bind().state.push("afterRender"),this},this.unbind=function(){return this.$el.off(),c.helpers.each(b.events,function(a,b){this[b.name]&&(this[b.name].onValue()(),this[b.name]=null)},this),this},this.bind=function(){return this.unbind(),c.helpers.each(b.events,function(a,b){this[b.name]=this.$el.asEventStream(b.type,b.el)},this),this},this.parse=function(){},this.remove=function(){this.state.push("beforeRemove"),this.state.end(),this.destroyModelOnRemove&&this.model.destroy(),this.$el.remove(),this.removeProperties()},this._constructor()},c});