<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="../node_modules/mocha/mocha.css" type="text/css"  />
</head>
<body>

  <div id="mocha"></div>

  <!-- Vendor -->
  <script src="../node_modules/mocha/mocha.js"></script>
  <script src="../node_modules/chai/chai.js" ></script>
  <script src="../node_modules/sinon/lib/sinon.js" ></script>
  <script src="../node_modules/sinon-chai/lib/sinon-chai.js" ></script>
  <script src="../node_modules/simulant/simulant.js"></script>

  <script src="../node_modules/jquery/dist/jquery.js"></script>
  <script src="../node_modules/bacon.model/node_modules/baconjs/dist/Bacon.js"></script>
  <script src="../node_modules/bacon.model/dist/bacon.model.js"></script>

  <script>
    mocha.setup('bdd');
    // Setup chai
    var assert = chai.assert,
    should = chai.should,
    expect = chai.expect;
  </script>
  <script src="../dist/Butter.js"></script>
  <script src="specs/core.specs.js"></script>
  <!-- run mocha -->
  <script>
    var runner;

    runner = mocha.run();

    var failedTests = [];

    function logFailure(test, err){
      var flattenTitles = function(test){
        var titles = [];
        while (test.parent.title){
          titles.push(test.parent.title);
          test = test.parent;
        }
        return titles.reverse();
      };

      failedTests.push({name: test.title, result: false, message: err.message, stack: err.stack, titles: flattenTitles(test) });
    }

    runner.on('end', function(){
      window.mochaResults = runner.stats;
      window.mochaResults.reports = failedTests;
    });

    runner.on('fail', logFailure);
  </script>
  </body>
</html>